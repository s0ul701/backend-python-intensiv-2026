# Варианты работ

## Пояснение
Студентам предлагается создать один из сервисов, представленных ниже. К каждому сервису предъявляются требования (общие и специфичные), так же представленные ниже.

## Общие требования ко всем сервисам
- сервис написан на FastAPI с использованием Pydantic
- для функционала сервиса написаны тесты с использованием Pytest
- сервис инструментирован Prometheus-метриками
- сервис обёрнут в Docker
- сервис использует Redis
- метрики сервиса отрисованы в Grafana
- сервис реализует базовые метрики:
  - количество запросов (с разбивкой по HTTP-статусам ответов)
  - время ответа на запрос (с разбивкой по HTTP-статусам ответов)

## Специфичные требования по сервисам
### Сервис проверки документов
#### Легенда
Сервис принимает паспортные данные клиента, которые были распознаны с фотографии документа сторонним сервисом. Затем, сервис осуществляет валидацию этих данных: сравнивает их, проверяя корректность.

#### Требования
- сервис реализует один эндпоинт
- входные данные эндпоинта: дата рождения клиента, серия/номер документа, [МЧЗ-строка](https://www.consultant.ru/document/cons_doc_LAW_384459/62023e40ffe7c02553bb9c9549df200b0945e989/)
- логика эндпоинта:
  - перед осуществлением логики сравнения сервис проверяет, есть ли в Redis закэшированный результат сравнения полученных данных
  - если результат в Redis есть, сервис возвращает закэшированный результат
  - если результата в Redis нет:
    - сервис извлекает дату рождения и серию/номер документа из  МЧЗ-строки и сравнивает их с аналогичными данными, полученными в запросе
    - если найдено полное совпадение - эндпоинт возвращает в ответе True, иначе - False
    - сервис кэширует полученный результат в Redis

#### Примеры запроса/ответа
```json
// Запрос
{
    "birth_date": "22.08.1977",
    "doc_number": "0525 185673",
    "mrz": "PNRUS<<IVANOV<<IVAN<<IVANOVICH<<<<<<<<<<<<<<\n0521856730RUS7708220M4510220<<<<<<<<<<<<<<44"
}

// Ответ
{
    "result": true,
}
```

### Сервис антифрода
#### Легенда
Сервис принимает набор данных клиента, содержащихся в сторонней системе (хранилище данных). Затем, на основе переданных данных осуществляет проверки правил, препятствующих дальнейшему кредитному скорингу.

#### Требования
- сервис реализует один эндпоинт
- входные данные эндпоинта: дата рождения, номер телефона, история займов (список из объектов, каждый из которых содержит сумму займа, дату его оформления, и флаг закрытия)
- логика эндпоинта:
  - перед осуществлением логики проверки сервис проверяет, есть ли в Redis закэшированный результат проверки полученных данных
  - если результат в Redis есть, сервис возвращает закэшированный результат
  - если результата в Redis нет:
    - сервис делает проверки:
      - если телефон начинает не с +7 (или 8), считаем, что сработал стоп-фактор
      - если клиенту меньше 18 лет, считаем, что сработал стоп-фактор
      - если у клиента есть хотя бы один не закрытый займ, считаем, что сработал стоп-фактор
    - в качестве ответа на эндпоинте сервис возвращает список из не пройденных проверок и итоговый флаг прохождения/не прохождения проверок
    - сервис кэширует полученный результат в Redis

#### Примеры запроса/ответа
```json
// Запрос
{
    "birth_date": "22.08.1977",
    "phone_number": "+79235648563",
    "loans_history": [
        {
            "amount": 10000,
            "loan_data": "22.10.2025",
            "is_closed": true,
        },
        {
            "amount": 25000,
            "loan_data": "01.12.2025",
            "is_closed": true,
        },
    ],
}

// Ответ
{
    "stop_factors": [],
    "result": true,
}
```

### Сервис скоринга
#### Легенда
Сервис принимает набор данных клиента, содержащихся в сторонней системе (хранилище данных). Затем, на основе полученных данных определяет сумму, которую можно выдать клиенту.

#### Требования
- сервис реализует один эндпоинт
- входные данные эндпоинта: уровень дохода, история займов (список из объектов, которые содержат сумму займа, дату его оформления, и флаг закрытия)
- логика эндпоинта:
  - перед осуществлением логики выбора суммы сервис проверяет, есть ли в Redis закэшированный результат выбора суммы для полученных данных
  - если результат в Redis есть, сервис возвращает закэшированный результат
  - если результата в Redis нет:
    - сервис осуществляет логику выбора суммы:
      - если в истории займов содержится хотя бы один займ, сервис одобряет займ на 30000₽
      - если история займов пуста и уровень дохода выше 50000₽, сервис одобряет займ на 20000₽
      - если история займов пуста и уровень дохода выше 30000₽, сервис одобряет займ на 10000₽
      - в остальных случаях сервис одобряет 0₽
    - в качестве ответа на эндпоинте сервис возвращает одобренную сумму
    - сервис кэширует полученный результат в Redis

#### Примеры запроса/ответа
```json
// Запрос
{
    "income_amount": 10000,
    "loans_history": [
        {
            "amount": 10000,
            "loan_data": "22.10.2025",
            "is_closed": true,
        },
        {
            "amount": 25000,
            "loan_data": "01.12.2025",
            "is_closed": true,
        },
    ],
}

// Ответ
{
    "result": 30000,
}
```